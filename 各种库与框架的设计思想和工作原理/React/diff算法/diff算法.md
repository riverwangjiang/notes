## diff算法

蓝色框框的部分分别是Diff算法的核心代码updateChildren以及processUpdates，通过Diff算法获取了组件更新的updates队列之后一次性进行更新。

## 对此React的做法是给出合理的假设和方法来让整个diff过程合理简化。

对此React的做法是给出合理的假设和方法来让整个diff过程合理简化。

- DOM节点跨层级的移动操作的场景是很少见的，可以忽略不计。（合理，可以通过组件的设计来尽量保证DOM结构的稳定，必要时可以通过CSS的方法来进行DOM在展示上的调整，因为创建、删除以及移动DOM的操作是能少则少，**浏览器的每个DOM节点都是一个大对象，有着很多的方法和属性**）
- 同一类的两个组件将会生成相似的树形结构，不同类的两个组件将会生成不同的树形结构。（合理，**本身组件就有提高页面的可复用性的作用**，也就是将结构功能类似的页面结构（或者说相似的DOM树形结构）抽象成一类组件，所以合理的组件抽象就应该满足这条假设）
- 对于同一层级的一组节点可以通过设置唯一的key来进行区分，从而做到diff的进一步优化。（这个不算是一个假设而是一个提高性能的方法）
- 对于同一类的两个组件，有可能其Virtual Dom是没有任何变化的。因此React允许开发者通过**shouldComponentUpdate()**来判断组件是否需要进行diff算法分析。（合理，开发者本身对页面的理解来进一步进行diff的优化，当然这有可能会因为开发者错误的使用shouldComponentUpdate()判断错误了是否需要更新，从而得到了错误的结果。

基于上面的几条，在具体的Diff过程中React只进行分层比较，新旧的树之间只比较同一个层次的节点。节点的操作分为3种：插入、移动和删除。


